{
    "$schema": "https://json-schema.org/draft/2020-12/schema",
    "$defs": {
        "urlWithSchema": {
          "type": "string",
          "pattern": "^$|^http(s?):\/\/.*"
        },
        "secretNameKey": {
          "type": "object",
          "properties": {
            "name": {
              "type": "string"
            },
            "key": {
              "type": "string"
            }
          },
          "additionalProperties": false
        }
      },
    "type": "object",
    "properties": {
      "brokerClientUrl": {
        "$ref": "#/$defs/urlWithSchema"
      },
      "tenant": {
        "type": "string",
        "enum": ["US", "EU", "AU", "default"],
        "default": "default",
        "description": "Optionally specify a Snyk Region."
      },
      "preflightChecks": {
        "type": "object",
        "properties": {
          "enabled": {
            "type": "boolean",
            "default": true,
            "description": "Enable broker client preflight checks."
          }
        }
      },
      "deploymentId": {
        "type": "uuid",
        "default": "",
        "description": "Obtained by installing the Broker App at the Organization level."
      },
      "clientId": {
        "type": "uuid",
        "default": "",
        "description": "Obtained by installing the Broker App at the Organization level."
      },
      "clientSecret": {
        "type": "uuid",
        "default": "",
        "description": "Obtained by installing the Broker App at the Organization level."
      },
      "existingAuthSecret": {
        "$ref": "#/$defs/secretNameKey"
      },
      "credentialReferences": {
        "type": "array",
        "items": {
          "type": "object",
          "additionalProperties": {
            "type": "string"
          }
        },
        "default": [],
        "description": "SCM token credential reference."
      },
      "containerPort": {
        "type": "integer",
        "default": 8000,
        "description": "Port to open for HTTP in Broker."
      },
      "hostAliases": {
        "type": "array",
        "items": {
          "type": "object",
          "properties": {
            "ip": {
              "type": "string"
            },
            "hostnames": {
              "type": "array",
              "items": {
                "type": "string"
              }
            }
          }
        },
        "default": [],
        "description": "Broker pod host aliases."
      },
      "resources": {
        "type": "object",
        "properties": {
          "requests": {
            "type": "object",
            "properties": {
              "cpu": {
                "type": "string",
                "default": "2"
              },
              "memory": {
                "type": "string",
                "default": "512Mi"
              }
            }
          },
          "limits": {
            "type": "object",
            "properties": {
              "cpu": {
                "type": "string",
                "default": "3"
              },
              "memory": {
                "type": "string",
                "default": "1024Mi"
              }
            }
          }
        }
      },
      "commonLabels": {
        "type": "object",
        "default": {},
        "description": "Labels to add to all deployed objects."
      },
      "commonAnnotations": {
        "type": "object",
        "default": {},
        "description": "Annotations to add to all deployed objects."
      },
      "podLabels": {
        "type": "object",
        "default": {},
        "description": "Pod labels."
      },
      "livenessProbe": {
        "type": "object",
        "properties": {
          "enabled": {
            "type": "boolean",
            "default": true
          },
          "path": {
            "type": "string",
            "default": "/healthcheck"
          },
          "config": {
            "type": "object",
            "properties": {
              "initialDelaySeconds": {
                "type": "integer",
                "default": 3
              },
              "periodSeconds": {
                "type": "integer",
                "default": 10
              },
              "timeoutSeconds": {
                "type": "integer",
                "default": 1
              },
              "failureThreshold": {
                "type": "integer",
                "default": 3
              }
            }
          }
        }
      },
      "readinessProbe": {
        "type": "object",
        "properties": {
          "enabled": {
            "type": "boolean",
            "default": true
          },
          "path": {
            "type": "string",
            "default": "/healthcheck"
          },
          "config": {
            "type": "object",
            "properties": {
              "initialDelaySeconds": {
                "type": "integer",
                "default": 3
              },
              "periodSeconds": {
                "type": "integer",
                "default": 10
              },
              "timeoutSeconds": {
                "type": "integer",
                "default": 1
              },
              "failureThreshold": {
                "type": "integer",
                "default": 3
              }
            }
          }
        }
      },
      "highAvailabilityMode": {
        "type": "object",
        "properties": {
          "enabled": {
            "type": "boolean",
            "default": false
          }
        }
      },
      "replicaCount": {
        "type": "integer",
        "default": 1,
        "minimum": 1,
        "maximum": 4,
        "description": "Number for snyk broker when running in HA mode."
      },
      "logLevel": {
        "type": "string",
        "default": "info",
        "description": "Log Level for broker client pod."
      },
      "logEnableBody": {
        "type": "string",
        "default": "false",
        "description": "Enable additional logging."
      },
      "enableBrokerLocalWebserverOverHttps": {
        "type": "boolean",
        "default": false
      },
      "httpsCert": {
        "type": "string",
        "default": "",
        "description": "HTTPS certificate."
      },
      "httpsKey": {
        "type": "string",
        "default": "",
        "description": "HTTPS certificate key."
      },
      "caCert": {
        "type": "string",
        "default": "----- BEGIN CERTIFICATE -----\n.....\n----- END CERTIFICATE -----",
        "description": "CA certificate."
      },
      "disableCaCertTrust": {
        "type": "boolean",
        "default": true,
        "description": "Disable trust validation when providing your own CA certificate."
      },
      "tlsRejectUnauthorized": {
        "type": "string",
        "default": "",
        "description": "Set to '0' to disable trust validation when using self-signed certificates."
      },
      "httpProxy": {
        "$ref": "#/$defs/urlWithSchema"
      },
      "httpsProxy": {
        "$ref": "#/$defs/urlWithSchema"
      },
      "noProxy": {
        "type": "string",
        "default": "",
        "description": "Provide URL here which doesn't need to go through a proxy."
      },
      "image": {
        "type": "object",
        "properties": {
          "registry": {
            "type": "string",
            "default": "docker.io"
          },
          "repository": {
            "type": "string",
            "default": "snyk/broker"
          },
          "pullPolicy": {
            "type": "string",
            "enum": ["Always", "Never", "IfNotPresent"],
            "default": "IfNotPresent"
          },
          "tag": {
            "type": "string",
            "default": "",
            "description": "Broker image tag (immutable tags are recommended)."
          },
          "pullSecrets": {
            "type": "array",
            "items": {
              "type": "object",
              "properties": {
                "name": {
                  "type": "string"
                }
              }
            },
            "default": []
          }
        }
      },
      "serviceAccount": {
        "type": "object",
        "properties": {
          "create": {
            "type": "boolean",
            "default": true
          },
          "existingName": {
            "type": "string",
            "default": ""
          },
          "annotations": {
            "type": "object",
            "default": {}
          },
          "name": {
            "type": "string",
            "default": ""
          }
        }
      },
      "podSecurityContext": {
        "type": "object",
        "properties": {
          "enabled": {
            "type": "boolean",
            "default": true
          },
          "fsGroupChangePolicy": {
            "type": "string",
            "default": "Always"
          },
          "sysctls": {
            "type": "array",
            "items": {
              "type": "object"
            },
            "default": []
          },
          "supplementalGroups": {
            "type": "array",
            "items": {
              "type": "integer"
            },
            "default": []
          },
          "fsGroup": {
            "type": "integer",
            "default": 1000
          }
        }
      },
      "containerSecurityContext": {
        "type": "object",
        "properties": {
          "enabled": {
            "type": "boolean",
            "default": true
          },
          "seLinuxOptions": {
            "type": "object",
            "default": {}
          },
          "runAsUser": {
            "type": "integer",
            "default": 1000
          },
          "runAsGroup": {
            "type": "integer",
            "default": 1000
          },
          "runAsNonRoot": {
            "type": "boolean",
            "default": true
          },
          "privileged": {
            "type": "boolean",
            "default": false
          },
          "allowPrivilegeEscalation": {
            "type": "boolean",
            "default": false
          },
          "capabilities": {
            "type": "object",
            "properties": {
              "drop": {
                "type": "array",
                "items": {
                  "type": "string"
                },
                "default": ["ALL"]
              }
            }
          },
          "seccompProfile": {
            "type": "object",
            "properties": {
              "type": {
                "type": "string",
                "default": "RuntimeDefault"
              }
            }
          },
          "readOnlyRootFilesystem": {
            "type": "boolean",
            "default": true
          }
        }
      },
      "service": {
        "type": "object",
        "properties": {
          "type": {
            "type": "string",
            "default": "ClusterIP"
          },
          "ports": {
            "type": "object",
            "properties": {
              "http": {
                "type": "integer",
                "default": 8000
              }
            }
          },
          "extraPorts": {
            "type": "array",
            "items": {
              "type": "object"
            },
            "default": []
          },
          "tls": {
            "type": "array",
            "items": {
              "type": "object"
            },
            "default": []
          }
        }
      },
      "ingress": {
        "type": "object",
        "properties": {
          "enabled": {
            "type": "boolean",
            "default": true
          },
          "ingressClassName": {
            "type": "string",
            "default": ""
          },
          "annotations": {
            "type": "object",
            "default": {}
          },
          "path": {
            "type": "string",
            "default": "/"
          },
          "pathType": {
            "type": "string",
            "default": "Prefix"
          },
          "hostname": {
            "type": "string",
            "default": "broker.local"
          },
          "extraHosts": {
            "type": "array",
            "items": {
              "type": "string"
            },
            "default": []
          },
          "extraPaths": {
            "type": "array",
            "items": {
              "type": "string"
            },
            "default": []
          },
          "existingSecret": {
            "$ref": "#/$defs/secretNameKey"
          },
          "tls": {
            "type": "object",
            "properties": {
              "enabled": {
                "type": "boolean",
                "default": true
              },
              "secret": {
                "type": "object",
                "properties": {
                  "key": {
                    "type": "string",
                    "default": ""
                  },
                  "cert": {
                    "type": "string",
                    "default": ""
                  }
                }
              }
            }
          }
        }
      },
      "extraVolumes": {
        "type": "array",
        "items": {
          "type": "object"
        },
        "default": []
      },
      "extraVolumeMounts": {
        "type": "array",
        "items": {
          "type": "object"
        },
        "default": []
      }
    }
}